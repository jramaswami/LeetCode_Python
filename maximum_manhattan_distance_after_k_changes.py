"""
LeetCode
3443. Maximum Manhattan Distance After K Changes
June 2025 Challenge
jramaswami
"""


class Solution:
    def maxDistance(self, s: str, k: int) -> int:
        # At each step I can evaluate the best changes to have made
        # on previous steps.  The best changes are to change min(N, S)
        # and min(E, W) to the opposite direction.  Make sure to cap the changes
        # that can be made to k.
        soln = 0
        freqs = {dirn: 0 for dirn in 'NSEW'}
        for dirn in s:
            freqs[dirn] += 1
            delta = 2 * min(k, min(freqs['N'], freqs['S']) + min(freqs['E'], freqs['W']))
            dist = (abs(freqs['N'] - freqs['S']) + abs(freqs['E'] - freqs['W']))
            soln = max(soln, dist + delta)
        return soln


def test_1():
    s = "NWSE"
    k = 1
    expected = 3
    assert Solution().maxDistance(s, k) == expected


def test_2():
    s = "NSWWEW"
    k = 3
    expected = 6
    assert Solution().maxDistance(s, k) == expected


def test_3():
    "TLE"
    s = "WNSNSWESWSSWEWNSWEWESEEEESWEWSNENNSSNWNESWWNNSSNNSWSWEWEENSNWWNSSWNSSESESSSNNWESWNENSWSNEWSWENEWENWWSNSWSESENESNESSEEEWWWNENNWWWSNWWWSNNWEEEWWWNEEWNEEWSNNESWWSSNWNEESNWSEWWSWNWNSSNEESENNWSWWWEESNESNENEEESSESWWWWSNEWWNSNEWNSENSENSWNSNENSWSENESEEWEENESWWWWWWEEEESWWEENENENNEWENSNEESNSWNSEENSEWSNEWENNWWNWNSNSWESSSEENSSWWNSWSESEWWNWWWSWNWSWSEWSESWSEEENWNNESWNNWWNSESWWWEWESEESSWWSESSSWSSNSWWNEWWNWNSNSSWSENESWSNNNNWSNWNWNWNSWESSSESSESWESSWEWWSWNENSNWNEWWSENSSSNSNWWNWWENNEWWNWESNESSSESSSSNWNNWWSNENESNNSNENEWEESESNSEEESEEWNSSWWWNSWENWSEENEEENEWSWSNNESWWNSENSNSENNESNNWSSWNNNNSENEESSNSEEWESNNSWSWNWESEWNNSSWNWWSWWWSWSWWWNNEEESENNWSSEENWWSSWSSSSWNSNWWSSSWNSEESWNNNENNNENSSWSSNENWSNEENEWSNSWSNNNESEEENSENNEWEWWENEEWSEENENWENNNSESNEWENEENESESEESESWNSSWNSNESNSEENNSWWWNWESSESESWWEEWNWNSNEENEEESSWWWEESWNSNEWSEENWSSSWWWEWWEWNWWSSNWSENSSSSSWNENENWEWESNENNNNENSNNWWNESENESNNENWSSWSWESNESENWESWEWNENSSSWWWESESEWEESNWNEWSESSWSSSSSNNSWNNWSWEESSNESSNWNWEEWWNSWSSNNSENWWWWESESNWNEEWNNSENSWNWENESWNNNSESWSWNEEWSSSNSWNWEEWESWNWWSNSSEWWWESESSSEESSSWNWWSWSSNSSESWSESSSWSWWNWSNNWESWWESENNWWEWEWSNSWWSNSWESWNNWNEENNSNSSESSSSWNEESSSNWESSSEENNWWWWNWEESESNNNESENNSNNWNNNSEENNWNSEWNENWSNSSENWWENEWENNNSWSWENNNNSSSESSSEWENEWSNNSESENEWNNNNENWEENWWSWWNWSNNSSNNSSNESWNWWEESESSENNNEENSEESNSWSSWESSWWNSESWNESEEEEEEWESENEESSSNNNWWWNEWENWWESWEWWSSWSWNWESESWWWESEESWWSENSNNNSSEEENSSEWWSSSWENEWENSWWNNESNNWNESNWWEWWWWESSEWESESEEEEESWSNESNEWSSWWWNSEENWNWSNSEWEWWNSSENESENENSSNESEEEWESENWNSENWNWNSENNWWWNSNNNNWNSSESSNWESNENNENWNNSSNESNENNWNSENSEENESSNWNENWNESSNNNSENWESWNWNNNEEWWESEWNSNEEENNEWSNENWWEWSESNSSWEENEWEWWWSSSWNESWWNNSSNNEEENSESWWSWESNNNWEENNEESENWESEWNNNEEWSSSSEEENSEESESWSNSWENSWSWWWESEENSNESENNWNNENEENSSWSESEESSSSSSSNNEWNENENWESWSEWWSEWWWWNSNESNWNENNEEEWEEENWENSSNNSNENEWWEEEWNEEWENESWSWSEEEENSSNSNNNSNEENSWENSWSEESSENSEESNSESNSSWNEWNEEESESNNNNNNWESSENSSNWENWNWENWWENSESSNSESNWESSENWSSEENWWWSSESNEEENEENNSWWENSENENWEESENWNNEEWWESWSNESNSNNSESNNENNEWWENSWWSNENEESNWSNNESNWSENSESEWSENNSNWNSWESNSWWSWNSWWWENEEESSSSNSNSSSWENNEWSSNSENSSESWSNEENNSNSNENNWSWSSSSEWNEENWWNNWWSWSESWNWSNWSNNWNNEESENSSWWNSWWWNNSWNEWEWSSNWWNWEWSENNSSSSWNEWNSEESNNNSENWNNNNWSNWWESWWEWEEWSWNWESWNSNEWWEWNENNESENEEWWWESEENWNWEWEWENWSESEEEESWSNEEWWNWWESWWNNWSENESNWWEWEENNSSEEWSNWSENNWSEENSWSWENENSESNEESNWEEWWESSSSSSNNSNSWWSWSWWNSNEWENNWWEEENEENESSSWSNENWESWENEWEWWWSNSNNWSNENNESSEWSEWNSWWSNSEESWSSWWSNNWSEWNNSSEESEEWWNWWNWWSWNSNSNWWWNSNSWWNWSEWSENWESWWESENSEENEWWENSSENNNESESESSSSNSWWNWWEENWSENWENWWSWNWEESSSEWWNSWWESSEEESSSENNEWWNNESESSENNWENSEESEENENWWSSWWNSEWNNWWEWWENEEWWWESESNSENSNNWWWWNSEEEWNWWESWSSWSSWWESSSSNNESSWSSWESESWWEWNWNSNWWNNNSWWWNSWESSSSNWWEWSEWNENENNNNEEENWWESNSWNEWSENWESSENEWWESNSWESWWESEWNENEESNWSNESNENWSNSSWSWWENWSNNSESSWWWESNENWSSWWNNESNNNENEEEWWENWSEEWESESNNNNESSNNWWSENESWEWNESWSESWEWSWSSSEWWNNESNEWESWNWWNSEESESWEWSWWSEESWEENWEWNNEWSSWSNSWNEEWNSNWNWNWSSSSWNENWWSEEEEESESNWEWSWEEEESWNNSWSSWSSENNWWWENESSSSEWEENSSESNSNESNSNWWSNSNWNENWNNNESNNSWENSWEWEWNWENENWSENWNSSEESNEESNEWSWEWWNWSNESNNNSEENSWNWEEEWNWSWNWEWSNWSENWNEWESNEEWEWSNSESSWEWEWWSWWSWNNSSWSNNSEWENSEENSSWEWESEEWSWESNEWEESSESSESSENNWSNWWNEEWWNEWWWNWNSNEEENNWSENNSNSEWSSSNESSESESNNSWWNWWSSNSWNSEWEESNESSSENWWESSWSEWSNNNSEWESWEESEWWNESENWSNEEEWWEENNSSSWNSNSWESWNNEWESEEWWNWWWEESWEWSEWSNSESNWNSNESNESWNWWWSNENNWSNENSWSENESESEWSNNEWSENSWWWENSSENSENSEESEWNNWWSNWEWWESNEENSEWSWSNWSESEENEWWWWNSEEWNWWEEWNNWSSEEWWNESWNSWSNSSNNWEWSSEWSNWSWWWSNNNEWNEWESSWSWNNWNSWSESSWEESEEESENSNWEWSESSWNWSSWNWWSNSNNWSWNWEWWEWWESSWSNEEEWWWNNSNWWSSWWSEESEESESWEWNSEENNWESEENEEESNEWEWWSNENNSSNWSENWSNWEWNEENWESNSNEWWWNNSWSSNNSNNNSWENWNEENWNSENWEWWSENSWWWSNNNWEWWSEEWSNNNENENNNENNSWWEENSSESEWSNSSSWENNEEENSWSNNNWSNWNNEWSWSEWWWNSSNEWSEEEESSSSESNWSENWWESEWNWNWENWWSNEWSNSESNWWSWSNSSNWWSESNWSSNENSNWSNSSEEEENNEWNWSSNNSNESWNWSNSNSEWWWSWEWWSNESSNNSNWNWSWWSNENENWENSNEWWSSENSWEWWEENNWNWENSNNWEWSSWNEWNEENEWNNNNSEEWESWEENWEWNENWNNSWSWSNNWESSSWSSNSWWSNWEENNEWSNNNNENNWEEEENNNNSSNWNWEWSNENNNEESSWNNSNWEWEWEENSNNNEEESEEWSEESSNWEEWSSNSWSWSSEEEESWEWNWWWWNNWESNSNWSNNEEWWSEENEWSWWEWNNENWSNNSSSEWNWWWNNWNEWSWWNWENSENSWNNNWENNNEWSESNNWSSEESNWWNSNWSWEEESNWWENSNNWESSNEENNEEEWWENSSSNNEEWSESWWEWEENWEWESSNENENEENWEWWWWENESESWSNWSNNEEWSWWENWSEWENNENNWNNSESNNEWWENESSSSWEWWNSSSWNSNESNWSEESWEENSWSNSENSWEWESWNWWENWESEEESWNWNWSEWWWNNSSSSWWSNSENNESEWWSNWEWSEENENWNENWNEEWSWSSSNWSWWWEEESWSSSEENSSNWEWNSWSSWSESSENNNSWNSWWWESSEWWSSNSNSENWWNEWWWSNWNESNWSNWESNSSNNWNEESWNNSEEWEWENESNEENENESESWNWSSNEWNESWSWNESWSNWEWENSSEWSNWSWEESNWWESWSWEWSNNWESESESNWSSENSNWWWNWWENENWNNWNNSENENWWNWWNNEWEEEEEEWNSWNWEENSNNSWNWEESEESNEWEWWEENSNEWWNWSWEENSWNNNSNNESSWEESNSNSWENENNEWNSSNSNWNWWNWNWSWESSWEWSSNSNENEENSNNESSNWWWEESSSESNESWNNSESEENNESWEEESNNESSEWSEESWWEWSNWWSSNNEEWSSSNEEENWSEWSWSNWSSNWNWSNSESWSNNNSSNSSWNSWSNSWWENSNNNSNSSSENSWNNESNSWENEESNSSNSWWNWESEWWEEWNSNNWWSESNWSESWNNWNWNEESWWNWSWWSSNWSSNSNESWWSSWWESNSSEENNENWEEEWEWWSWESEEWWNEEWWESSNNSWENSSENNNNNEENSSNSNNEWNESSWNSWSSSEWSEENWSNSENSSNNEENWSNNWSWWSWSWSWSSWNSESSSESWNNSWNNNEEWWSWEESEESNWWSWNESEWENNWNNSWWWWNENWENSWENWNWNENNENSNSSENSENESSEEWSSWESNENWSSWWNSENEEESESESWSWESESWSSEWSWESSNSNSWWWEWSWEWSWEENNEWWNSSSWNENNWEEENEWNWWWNSSNESENNENESSSNSESNESSWSWNWEWSENWESNWSSWWNSENNSSWEWNESNEWWNSNWNESSEESNSSSEEWSNNWNEENSNSEWEWNNNNESWEEWESNEEWNNNSWSNNWEEEEENWWWWNSNENSWESSNNEESNSENNNSWEWWSNSNSNWSWEEEWNSWSEEWNEEESSWSNNEWWEWWNEEWSENSENSEWENEEWESNESESWSEESWNWSEWSENNNWSSNNNESNSEENWEENNSSNESSWENNSSNENSESSEEENEWWESENESSEWENWWNSSSSSSENWNENNWNSNSWWSEWWNNEEESNSESWWWESWNNEWWSSSNSENWEWEENWSNEWNNSSNEENESNSNEENESWSSEWSENNWSSEEESEWNEWESEENESESEENSNSSESNSWWEESESWSWWESENWNNNEWSEWNNNNNSSWWEESNESWESEENWNSSWWSSNEEEENNEWNESSNEESWWNWESWWWNENWSSEWWSNWESWWSSWEWSSSNENESNWSWNEWESWESSSWNNNEEEWSSSESESNWNNWWWWNWENEEWNNNWSSNSSWSESEENNSSEESENNSNSNSSWENSSWWNNESSNSWSSNWSWSWEEEEENESNENENNWWNSSSSEEEWNEWWWNENNWNSENEENSEEESWWSNWEENWSNNEENNSWSSNWNSNWNWEWEWWSSWSWSEENSESSEWNSWWSESWENSWWNSSWWWWESNWNENNSWSSWWNSSNSEESWWSNSSSSNNENEESESNEENEWWSNSNSENNENWSWWEWSNESWWWENEEEEEEWSWWSNWSENWNSNSNSSWNNWSWESNNNNSWESNSSSSWWWEEWSSNWNWSWSENSNWSEWEESSWEESESENNNWSEWNWSSENWSNENSEENNWENWESSNWEEWNNEWNNWNNNESSWSSNSEESENSESWSNNEWSSNNSNESEENNESWEEESSWSSEEWENNSWNSSWWNEWSWNESWEWNSSEEESNSNWSWNWNSEWEEESENESWWNSEENNEWSSNWENNWNESEENWNSESSSSSWSNWNNWWESNSWSWENESWEWESESSNWWWWESWEESNWSNNNENNEWSSENEESSWSWSNWWEWWNSNSWNSESESSWSNNSNWWWENEESWEESNSNESNNEENENESSNESESNWENENWEEENNNSWNNNNWESSWSSSENWWEWWNNWNSSWSESEEEWNWNSEWSNESSENSSENESSNWNNNNNESSWNWENNWNEEESWNSWSESSSNNWSSNWNNSEEWESNNSWSWNWEEESWEEEWEESESWSESSEENNWWWENWESWNSWSNESEESSNNNEWESWSNSNNEESEWNWNEWWNSSWEEESWWEWWWNWSNNNNWEESENEEWNWNENSESEEEESNWWESENWEWNWENSWEESWWSWSEEENESWENEWWNSEWSNSSNEENWSWSENNNNEWESNENNEEEEESSENNNEWSNNWWESEWNEWESNEWESNNWWNSNWEEEWSNSNSWNWEEESSWWNEWEENNNNESSSSNEWSENEESWNWWWENWSWNESNNESWSSSNWNEEESSWEENWNWNSWNSNWWWNWEENENWNESNNNEWSENEESEWNSWSSNSEWSEENEEWWWSWESNWSEWWESNNSENEEWNNNWESWSEWESENNSNNWWESSWSEWNNSESWNWENNWSSNNWNEWEESNSWEWNNEEESNNESEWSWSNSNNWNSSSEWEESWNSNSNWWWNNWWNEENEWNWENSNWSSWEWSNSNSESESENEWSWWSWSEENSSNSWEWWEEWEEWWENSNSWESSNNENNWENNEENENWNNSEWWWEENESWSSESWWWSWEWSESWSNENSSWENSNNNEEENESESSNNSWWSWSNWENEEWNSEEEWSNWWENNSWWNWSWEWSEEWWNSSNWEENWESNNNWESESESWEESENEEEWWWSWWSENSNSSESSNESNSSSNWNWNNWENWSWWWSSENNWNEESENSWWSEWNWWWNSNWNENSESNESSNWWEEEEENNEEEWWEENNNEEEENSESEWSENNSNNENSWNSNNEENSWSEWWSSWEWNSNWNNSNESNSNEWWNWNWWSNSSSNWNSWWWSWWSSSNEWWWWWWWENSWSENWWNSNNWESNESENWEWSNWWSSSSESNENSSESNNSWSNSNWNWWWSNEWNNNNNEWSENNWNEEEENNWWNENEEWWSSSNNWWWSNWWWEEWWNWSNWWSWNENESNWSSNSWWNEENWWNSWWSWWSSSSWSEWSSSNWENSWWNSNSNWWEWSSSEEEWNSWWSSSNSWSSESWWENESWWWWNWEESWESNNNWEENWNWNWSENSEWSWWSSWNSEEEWNSWESSNNNWSSESNWNSWNESNWNSEWNSWWNNENWNEESWNEESSEWSSWWENWEEWNWWWWNSSNWNWEESSSENNWNSNWWWENWSEENSEWNSWEESWWNSENEEWSNWENNNENNEEWWWNSWEESWESESWWNENWENSWNSNSNNWWENSWWENWNSESEESWEWNNENEWNWWWSSESNSNWSSWEESNWWENNNNNWWESNENNSNEWNNSWENWSWWNSNWESNENSNWWSSENWSEESNNNWWNNSESWEEENNSWEWESNNNSNSSEWEWESSEWSSWENENENNSNSEWWWWSSNEENSSEEWWNNEWWNENWSSWESEEWNNSSNENSEENEWSNNNWEWENSWNNESNWSSENENWSSENSEWSNENNESSWWEWNEEWESEEEEESNSSSSSNEESENWSSWNENWSWSENESWNENEENSEESEWSSWWNWWNNWSNSESEESWNWWWSSNWWSNNSSWWEWWESNWESESNSWWSEENSWEENENESWENEESNNSSNSNNSNEWNNWWWSNSSENWWNESWNENSWENEEEEWENENESEESEWNWSWNENSSWESSWEEWSSWWESWESEWSSWSWWEESSEWNEEWSSNSEESEEWNWWSSEENEENWSNWSSNWNWSWNNENSNEWNWSENWNWWWWNNNSNSESESNEESNSENWWWEWSNWWSSWWWESWSWSSSWWEWSNWENSNNSEWSSNENWSNSWWWWWESSSWEWESWEWWSWSSWESWEWNNWWWESENNSWNESEENWESNNENSEWNEWEWSNWNWSNNSENNNSSNSSSNSEEEEENESWNWSWWNWESNSEESSWWSNESWWWSWWNENESENNESNWWWWSNNNWNNEEWWSSEEWEWWNEEEEWSWWNWSNWWWNEWNSENWWEEWSNWNESWESNENWWEEWWSWESNSNSSSSWWWWENNEWWWENSNNWNWWNESWSSWNWENESNNWNSWNWSSWEWENNSENNESWEENWWNSNWSWWSNWSNWWSSWWNNEWNSNWSENENWENSSWSEEESWS"
    k = 6472
    expected = 8450
    assert Solution().maxDistance(s, k) == expected