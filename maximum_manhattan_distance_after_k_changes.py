"""
LeetCode
3443. Maximum Manhattan Distance After K Changes
June 2025 Challenge
jramaswami
"""


import collections
import dataclasses


@dataclasses.dataclass(frozen = True)
class Vector:
    x: int
    y: int

    def __add__(self, other):
        return Vector(self.x + other.x, self.y + other.y)

    def dist(self):
        return abs(self.x) + abs(self.y)


@dataclasses.dataclass(frozen = True)
class QItem:
    posn: Vector
    changes_left: int
    curr_index: int


DIRECTIONS = (
    ('N', Vector(0, 1)),
    ('S', Vector(0, -1)),
    ('E', Vector(1, 0)),
    ('W', Vector(-1, 0))
)


class Solution:
    def maxDistance(self, s: str, k: int) -> int:
        soln = 0
        visited = set()
        queue = collections.deque()
        x = QItem(Vector(0, 0), k, 0)
        queue.append(x)
        while queue:
            item = queue.popleft()
            soln = max(soln, item.posn.dist())
            if item.curr_index + 1 <= len(s):
                for dirn, offset in DIRECTIONS:
                    posn0 = item.posn + offset
                    if dirn == s[item.curr_index]:
                        item0 = QItem(posn0, item.changes_left, item.curr_index + 1)
                        if item0 not in visited:
                            queue.append(item0)
                            visited.add(item0)
                    elif item.changes_left > 0:
                        item0 = QItem(posn0, item.changes_left - 1, item.curr_index + 1)
                        if item0 not in visited:
                            queue.append(item0)
                            visited.add(item0)
        return soln


def test_1():
    s = "NWSE"
    k = 1
    expected = 3
    assert Solution().maxDistance(s, k) == expected


def test_2():
    s = "NSWWEW"
    k = 3
    expected = 6
    assert Solution().maxDistance(s, k) == expected


def test_3():
    "TLE"
    s = "WNSNSWESWSSWEWNSWEWESEEEESWEWSNENNSSNWNESWWNNSSNNSWSWEWEENSNWWNSSWNSSESESSSNNWESWNENSWSNEWSWENEWENWWSNSWSESENESNESSEEEWWWNENNWWWSNWWWSNNWEEEWWWNEEWNEEWSNNESWWSSNWNEESNWSEWWSWNWNSSNEESENNWSWWWEESNESNENEEESSESWWWWSNEWWNSNEWNSENSENSWNSNENSWSENESEEWEENESWWWWWWEEEESWWEENENENNEWENSNEESNSWNSEENSEWSNEWENNWWNWNSNSWESSSEENSSWWNSWSESEWWNWWWSWNWSWSEWSESWSEEENWNNESWNNWWNSESWWWEWESEESSWWSESSSWSSNSWWNEWWNWNSNSSWSENESWSNNNNWSNWNWNWNSWESSSESSESWESSWEWWSWNENSNWNEWWSENSSSNSNWWNWWENNEWWNWESNESSSESSSSNWNNWWSNENESNNSNENEWEESESNSEEESEEWNSSWWWNSWENWSEENEEENEWSWSNNESWWNSENSNSENNESNNWSSWNNNNSENEESSNSEEWESNNSWSWNWESEWNNSSWNWWSWWWSWSWWWNNEEESENNWSSEENWWSSWSSSSWNSNWWSSSWNSEESWNNNENNNENSSWSSNENWSNEENEWSNSWSNNNESEEENSENNEWEWWENEEWSEENENWENNNSESNEWENEENESESEESESWNSSWNSNESNSEENNSWWWNWESSESESWWEEWNWNSNEENEEESSWWWEESWNSNEWSEENWSSSWWWEWWEWNWWSSNWSENSSSSSWNENENWEWESNENNNNENSNNWWNESENESNNENWSSWSWESNESENWESWEWNENSSSWWWESESEWEESNWNEWSESSWSSSSSNNSWNNWSWEESSNESSNWNWEEWWNSWSSNNSENWWWWESESNWNEEWNNSENSWNWENESWNNNSESWSWNEEWSSSNSWNWEEWESWNWWSNSSEWWWESESSSEESSSWNWWSWSSNSSESWSESSSWSWWNWSNNWESWWESENNWWEWEWSNSWWSNSWESWNNWNEENNSNSSESSSSWNEESSSNWESSSEENNWWWWNWEESESNNNESENNSNNWNNNSEENNWNSEWNENWSNSSENWWENEWENNNSWSWENNNNSSSESSSEWENEWSNNSESENEWNNNNENWEENWWSWWNWSNNSSNNSSNESWNWWEESESSENNNEENSEESNSWSSWESSWWNSESWNESEEEEEEWESENEESSSNNNWWWNEWENWWESWEWWSSWSWNWESESWWWESEESWWSENSNNNSSEEENSSEWWSSSWENEWENSWWNNESNNWNESNWWEWWWWESSEWESESEEEEESWSNESNEWSSWWWNSEENWNWSNSEWEWWNSSENESENENSSNESEEEWESENWNSENWNWNSENNWWWNSNNNNWNSSESSNWESNENNENWNNSSNESNENNWNSENSEENESSNWNENWNESSNNNSENWESWNWNNNEEWWESEWNSNEEENNEWSNENWWEWSESNSSWEENEWEWWWSSSWNESWWNNSSNNEEENSESWWSWESNNNWEENNEESENWESEWNNNEEWSSSSEEENSEESESWSNSWENSWSWWWESEENSNESENNWNNENEENSSWSESEESSSSSSSNNEWNENENWESWSEWWSEWWWWNSNESNWNENNEEEWEEENWENSSNNSNENEWWEEEWNEEWENESWSWSEEEENSSNSNNNSNEENSWENSWSEESSENSEESNSESNSSWNEWNEEESESNNNNNNWESSENSSNWENWNWENWWENSESSNSESNWESSENWSSEENWWWSSESNEEENEENNSWWENSENENWEESENWNNEEWWESWSNESNSNNSESNNENNEWWENSWWSNENEESNWSNNESNWSENSESEWSENNSNWNSWESNSWWSWNSWWWENEEESSSSNSNSSSWENNEWSSNSENSSESWSNEENNSNSNENNWSWSSSSEWNEENWWNNWWSWSESWNWSNWSNNWNNEESENSSWWNSWWWNNSWNEWEWSSNWWNWEWSENNSSSSWNEWNSEESNNNSENWNNNNWSNWWESWWEWEEWSWNWESWNSNEWWEWNENNESENEEWWWESEENWNWEWEWENWSESEEEESWSNEEWWNWWESWWNNWSENESNWWEWEENNSSEEWSNWSENNWSEENSWSWENENSESNEESNWEEWWESSSSSSNNSNSWWSWSWWNSNEWENNWWEEENEENESSSWSNENWESWENEWEWWWSNSNNWSNENNESSEWSEWNSWWSNSEESWSSWWSNNWSEWNNSSEESEEWWNWWNWWSWNSNSNWWWNSNSWWNWSEWSENWESWWESENSEENEWWENSSENNNESESESSSSNSWWNWWEENWSENWENWWSWNWEESSSEWWNSWWESSEEESSSENNEWWNNESESSENNWENSEESEENENWWSSWWNSEWNNWWEWWENEEWWWESESNSENSNNWWWWNSEEEWNWWESWSSWSSWWESSSSNNESSWSSWESESWWEWNWNSNWWNNNSWWWNSWESSSSNWWEWSEWNENENNNNEEENWWESNSWNEWSENWESSENEWWESNSWESWWESEWNENEESNWSNESNENWSNSSWSWWENWSNNSESSWWWESNENWSSWWNNESNNNENEEEWWENWSEEWESESNNNNESSNNWWSENESWEWNESWSESWEWSWSSSEWWNNESNEWESWNWWNSEESESWEWSWWSEESWEENWEWNNEWSSWSNSWNEEWNSNWNWNWSSSSWNENWWSEEEEESESNWEWSWEEEESWNNSWSSWSSENNWWWENESSSSEWEENSSESNSNESNSNWWSNSNWNENWNNNESNNSWENSWEWEWNWENENWSENWNSSEESNEESNEWSWEWWNWSNESNNNSEENSWNWEEEWNWSWNWEWSNWSENWNEWESNEEWEWSNSESSWEWEWWSWWSWNNSSWSNNSEWENSEENSSWEWESEEWSWESNEWEESSESSESSENNWSNWWNEEWWNEWWWNWNSNEEENNWSENNSNSEWSSSNESSESESNNSWWNWWSSNSWNSEWEESNESSSENWWESSWSEWSNNNSEWESWEESEWWNESENWSNEEEWWEENNSSSWNSNSWESWNNEWESEEWWNWWWEESWEWSEWSNSESNWNSNESNESWNWWWSNENNWSNENSWSENESESEWSNNEWSENSWWWENSSENSENSEESEWNNWWSNWEWWESNEENSEWSWSNWSESEENEWWWWNSEEWNWWEEWNNWSSEEWWNESWNSWSNSSNNWEWSSEWSNWSWWWSNNNEWNEWESSWSWNNWNSWSESSWEESEEESENSNWEWSESSWNWSSWNWWSNSNNWSWNWEWWEWWESSWSNEEEWWWNNSNWWSSWWSEESEESESWEWNSEENNWESEENEEESNEWEWWSNENNSSNWSENWSNWEWNEENWESNSNEWWWNNSWSSNNSNNNSWENWNEENWNSENWEWWSENSWWWSNNNWEWWSEEWSNNNENENNNENNSWWEENSSESEWSNSSSWENNEEENSWSNNNWSNWNNEWSWSEWWWNSSNEWSEEEESSSSESNWSENWWESEWNWNWENWWSNEWSNSESNWWSWSNSSNWWSESNWSSNENSNWSNSSEEEENNEWNWSSNNSNESWNWSNSNSEWWWSWEWWSNESSNNSNWNWSWWSNENENWENSNEWWSSENSWEWWEENNWNWENSNNWEWSSWNEWNEENEWNNNNSEEWESWEENWEWNENWNNSWSWSNNWESSSWSSNSWWSNWEENNEWSNNNNENNWEEEENNNNSSNWNWEWSNENNNEESSWNNSNWEWEWEENSNNNEEESEEWSEESSNWEEWSSNSWSWSSEEEESWEWNWWWWNNWESNSNWSNNEEWWSEENEWSWWEWNNENWSNNSSSEWNWWWNNWNEWSWWNWENSENSWNNNWENNNEWSESNNWSSEESNWWNSNWSWEEESNWWENSNNWESSNEENNEEEWWENSSSNNEEWSESWWEWEENWEWESSNENENEENWEWWWWENESESWSNWSNNEEWSWWENWSEWENNENNWNNSESNNEWWENESSSSWEWWNSSSWNSNESNWSEESWEENSWSNSENSWEWESWNWWENWESEEESWNWNWSEWWWNNSSSSWWSNSENNESEWWSNWEWSEENENWNENWNEEWSWSSSNWSWWWEEESWSSSEENSSNWEWNSWSSWSESSENNNSWNSWWWESSEWWSSNSNSENWWNEWWWSNWNESNWSNWESNSSNNWNEESWNNSEEWEWENESNEENENESESWNWSSNEWNESWSWNESWSNWEWENSSEWSNWSWEESNWWESWSWEWSNNWESESESNWSSENSNWWWNWWENENWNNWNNSENENWWNWWNNEWEEEEEEWNSWNWEENSNNSWNWEESEESNEWEWWEENSNEWWNWSWEENSWNNNSNNESSWEESNSNSWENENNEWNSSNSNWNWWNWNWSWESSWEWSSNSNENEENSNNESSNWWWEESSSESNESWNNSESEENNESWEEESNNESSEWSEESWWEWSNWWSSNNEEWSSSNEEENWSEWSWSNWSSNWNWSNSESWSNNNSSNSSWNSWSNSWWENSNNNSNSSSENSWNNESNSWENEESNSSNSWWNWESEWWEEWNSNNWWSESNWSESWNNWNWNEESWWNWSWWSSNWSSNSNESWWSSWWESNSSEENNENWEEEWEWWSWESEEWWNEEWWESSNNSWENSSENNNNNEENSSNSNNEWNESSWNSWSSSEWSEENWSNSENSSNNEENWSNNWSWWSWSWSWSSWNSESSSESWNNSWNNNEEWWSWEESEESNWWSWNESEWENNWNNSWWWWNENWENSWENWNWNENNENSNSSENSENESSEEWSSWESNENWSSWWNSENEEESESESWSWESESWSSEWSWESSNSNSWWWEWSWEWSWEENNEWWNSSSWNENNWEEENEWNWWWNSSNESENNENESSSNSESNESSWSWNWEWSENWESNWSSWWNSENNSSWEWNESNEWWNSNWNESSEESNSSSEEWSNNWNEENSNSEWEWNNNNESWEEWESNEEWNNNSWSNNWEEEEENWWWWNSNENSWESSNNEESNSENNNSWEWWSNSNSNWSWEEEWNSWSEEWNEEESSWSNNEWWEWWNEEWSENSENSEWENEEWESNESESWSEESWNWSEWSENNNWSSNNNESNSEENWEENNSSNESSWENNSSNENSESSEEENEWWESENESSEWENWWNSSSSSSENWNENNWNSNSWWSEWWNNEEESNSESWWWESWNNEWWSSSNSENWEWEENWSNEWNNSSNEENESNSNEENESWSSEWSENNWSSEEESEWNEWESEENESESEENSNSSESNSWWEESESWSWWESENWNNNEWSEWNNNNNSSWWEESNESWESEENWNSSWWSSNEEEENNEWNESSNEESWWNWESWWWNENWSSEWWSNWESWWSSWEWSSSNENESNWSWNEWESWESSSWNNNEEEWSSSESESNWNNWWWWNWENEEWNNNWSSNSSWSESEENNSSEESENNSNSNSSWENSSWWNNESSNSWSSNWSWSWEEEEENESNENENNWWNSSSSEEEWNEWWWNENNWNSENEENSEEESWWSNWEENWSNNEENNSWSSNWNSNWNWEWEWWSSWSWSEENSESSEWNSWWSESWENSWWNSSWWWWESNWNENNSWSSWWNSSNSEESWWSNSSSSNNENEESESNEENEWWSNSNSENNENWSWWEWSNESWWWENEEEEEEWSWWSNWSENWNSNSNSSWNNWSWESNNNNSWESNSSSSWWWEEWSSNWNWSWSENSNWSEWEESSWEESESENNNWSEWNWSSENWSNENSEENNWENWESSNWEEWNNEWNNWNNNESSWSSNSEESENSESWSNNEWSSNNSNESEENNESWEEESSWSSEEWENNSWNSSWWNEWSWNESWEWNSSEEESNSNWSWNWNSEWEEESENESWWNSEENNEWSSNWENNWNESEENWNSESSSSSWSNWNNWWESNSWSWENESWEWESESSNWWWWESWEESNWSNNNENNEWSSENEESSWSWSNWWEWWNSNSWNSESESSWSNNSNWWWENEESWEESNSNESNNEENENESSNESESNWENENWEEENNNSWNNNNWESSWSSSENWWEWWNNWNSSWSESEEEWNWNSEWSNESSENSSENESSNWNNNNNESSWNWENNWNEEESWNSWSESSSNNWSSNWNNSEEWESNNSWSWNWEEESWEEEWEESESWSESSEENNWWWENWESWNSWSNESEESSNNNEWESWSNSNNEESEWNWNEWWNSSWEEESWWEWWWNWSNNNNWEESENEEWNWNENSESEEEESNWWESENWEWNWENSWEESWWSWSEEENESWENEWWNSEWSNSSNEENWSWSENNNNEWESNENNEEEEESSENNNEWSNNWWESEWNEWESNEWESNNWWNSNWEEEWSNSNSWNWEEESSWWNEWEENNNNESSSSNEWSENEESWNWWWENWSWNESNNESWSSSNWNEEESSWEENWNWNSWNSNWWWNWEENENWNESNNNEWSENEESEWNSWSSNSEWSEENEEWWWSWESNWSEWWESNNSENEEWNNNWESWSEWESENNSNNWWESSWSEWNNSESWNWENNWSSNNWNEWEESNSWEWNNEEESNNESEWSWSNSNNWNSSSEWEESWNSNSNWWWNNWWNEENEWNWENSNWSSWEWSNSNSESESENEWSWWSWSEENSSNSWEWWEEWEEWWENSNSWESSNNENNWENNEENENWNNSEWWWEENESWSSESWWWSWEWSESWSNENSSWENSNNNEEENESESSNNSWWSWSNWENEEWNSEEEWSNWWENNSWWNWSWEWSEEWWNSSNWEENWESNNNWESESESWEESENEEEWWWSWWSENSNSSESSNESNSSSNWNWNNWENWSWWWSSENNWNEESENSWWSEWNWWWNSNWNENSESNESSNWWEEEEENNEEEWWEENNNEEEENSESEWSENNSNNENSWNSNNEENSWSEWWSSWEWNSNWNNSNESNSNEWWNWNWWSNSSSNWNSWWWSWWSSSNEWWWWWWWENSWSENWWNSNNWESNESENWEWSNWWSSSSESNENSSESNNSWSNSNWNWWWSNEWNNNNNEWSENNWNEEEENNWWNENEEWWSSSNNWWWSNWWWEEWWNWSNWWSWNENESNWSSNSWWNEENWWNSWWSWWSSSSWSEWSSSNWENSWWNSNSNWWEWSSSEEEWNSWWSSSNSWSSESWWENESWWWWNWEESWESNNNWEENWNWNWSENSEWSWWSSWNSEEEWNSWESSNNNWSSESNWNSWNESNWNSEWNSWWNNENWNEESWNEESSEWSSWWENWEEWNWWWWNSSNWNWEESSSENNWNSNWWWENWSEENSEWNSWEESWWNSENEEWSNWENNNENNEEWWWNSWEESWESESWWNENWENSWNSNSNNWWENSWWENWNSESEESWEWNNENEWNWWWSSESNSNWSSWEESNWWENNNNNWWESNENNSNEWNNSWENWSWWNSNWESNENSNWWSSENWSEESNNNWWNNSESWEEENNSWEWESNNNSNSSEWEWESSEWSSWENENENNSNSEWWWWSSNEENSSEEWWNNEWWNENWSSWESEEWNNSSNENSEENEWSNNNWEWENSWNNESNWSSENENWSSENSEWSNENNESSWWEWNEEWESEEEEESNSSSSSNEESENWSSWNENWSWSENESWNENEENSEESEWSSWWNWWNNWSNSESEESWNWWWSSNWWSNNSSWWEWWESNWESESNSWWSEENSWEENENESWENEESNNSSNSNNSNEWNNWWWSNSSENWWNESWNENSWENEEEEWENENESEESEWNWSWNENSSWESSWEEWSSWWESWESEWSSWSWWEESSEWNEEWSSNSEESEEWNWWSSEENEENWSNWSSNWNWSWNNENSNEWNWSENWNWWWWNNNSNSESESNEESNSENWWWEWSNWWSSWWWESWSWSSSWWEWSNWENSNNSEWSSNENWSNSWWWWWESSSWEWESWEWWSWSSWESWEWNNWWWESENNSWNESEENWESNNENSEWNEWEWSNWNWSNNSENNNSSNSSSNSEEEEENESWNWSWWNWESNSEESSWWSNESWWWSWWNENESENNESNWWWWSNNNWNNEEWWSSEEWEWWNEEEEWSWWNWSNWWWNEWNSENWWEEWSNWNESWESNENWWEEWWSWESNSNSSSSWWWWENNEWWWENSNNWNWWNESWSSWNWENESNNWNSWNWSSWEWENNSENNESWEENWWNSNWSWWSNWSNWWSSWWNNEWNSNWSENENWENSSWSEEESWS"
    k = 6472
    expected = -1
    assert Solution().maxDistance(s, k) == expected